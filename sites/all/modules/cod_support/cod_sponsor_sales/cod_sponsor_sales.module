<?php
/**
 * @file
 * cod_sponsor_sales.module
 *
 * Main entry for the cod_sponsor_sales feature.
 */

include_once 'includes/SponsorSales.inc';
include_once 'includes/EntityForm.inc';
include_once 'includes/SponsorSalesForm.inc';

/**
 * Implements hook_form_FORM_ID_alter().
 */
function cod_sponsor_sales_form_sponsor_node_form_alter(&$form, &$form_state) {
  $sponsor_form = new SponsorSalesForm($form);

  // Unrequire sponsor level when no sponsor level optons are available.
  $sponsor_form->unrequireSponsorLevel();

  if ($sponsor_form->isReady()) {
    // Override the commerce_node_checkout form alteration.
    $sponsor_form->addDefaultSponsorshipItem();
  }

  $sponsor_form->addSponsorshipActionCallback();
}

/**
 * Callback funtion for sponsor node form submission.
 *
 * When a sponsorship taxanomy level is selected adds
 * the associated sponsorship product to the Sponsor node.
 */
function sponsor_sales_add_sponsorship($form, &$form_state) {
  $form['#sponsorship_sales']->addSponsorshipValue($form_state);
}
